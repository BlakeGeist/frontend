'use strict';

const _ = require('lodash');
const Joi = require('joi');
const buildSchema = require('./../build-schema');
const common = require('../common');

const baseFields = {
  id: common.id,
  merchant_id: common.id,
  unique_hash: Joi.string().max(40),
  affiliate_id: Joi.string().max(100).allow(''),
  affiliate_tracking_url: Joi.string().max(1000).allow(''),
  description: common.description,
  display_url: Joi.string().max(1000).allow(''),
  code: Joi.string().max(100).allow('').description('Coupon code if one is needed to be entered on the merchant website (deals with codes are thus sometimes semantically referred to as coupons)'),
  restriction: Joi.string().max(6000).allow(''),
  imp_overridden_fields: Joi.string().max(100).allow('').allow(null),
  start_date: Joi.date().iso().allow(null),
  end_date: Joi.date().iso().allow(null),
  imp_created_via: common.createdVia,
  imp_last_import_time: Joi.date(),
  reviewed: Joi.number().integer().max(1),
  active: common.active
};

const detailFields = {
  id: common.id,
  deal_id: common.id,
  lang: common.lang,
  region: common.region,
  name: common.name,
  slug: common.slug,
  description: common.description,
  display_url: Joi.string().max(1000).allow(''),
  code: Joi.string().max(100).allow('').description('Coupon code if one is needed to be entered on the merchant website (deals with codes are thus sometimes semantically referred to as coupons)'),
  restriction: Joi.string().max(6000).allow(''),
  reviewed: Joi.number().integer().max(1),
  active: common.active,
  rank: Joi.number().integer()
};

const requiredForPost = [];

const attributeFields = {};

const additionalForbiddenAttribs = [];

module.exports = buildSchema(_.merge(baseFields, detailFields), requiredForPost, attributeFields, additionalForbiddenAttribs);
