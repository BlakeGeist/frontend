'use strict';

const _ = require('lodash');
const Joi = require('joi');
const buildSchema = require('./../build-schema');
const common = require('../common');

const baseFields = {
  id: common.id,
  merchant_id: common.id,
  unique_hash: Joi.string().max(40),
  affiliate_id: Joi.string().max(100).allow(''),
  affiliate_tracking_url: Joi.string().max(1000).allow(''),
  rate: Joi.number(),
  type: Joi.string().valid(['cashback', 'flat', 'compound']),
  flat: Joi.number().allow(null).min(0).max(99999999999),
  currency: Joi.string().allow(null).regex(/^[a-zA-Z]{3}$/),
  imp_created_via: common.createdVia,
  imp_last_import_time: Joi.date()
};

const detailFields = {
  id: common.id,
  cashback_id: common.id,
  lang: common.lang,
  region: common.region,
  name: common.name,
  slug: common.slug.allow(''),
  description: common.description,
  display_url: Joi.string().max(1000).allow(''),
  reviewed: Joi.number().integer().max(1),
  active: common.active,
  rank: Joi.number().integer()
};

const requiredForPost = [];

const attributeFields = {};

const additionalForbiddenAttribs = ['default', 'minRate', 'maxRate', 'rate'];

module.exports = buildSchema(_.merge(baseFields, detailFields), requiredForPost, attributeFields, additionalForbiddenAttribs);
